// 数据意义：中国进口额，中国下月进口额，中国进口额，美国进口额
var myChart = echarts.init(document.getElementById('main'));
var data0 = splitData([
    ['2015/1', 140561.0, 108485.0, 140561.0, 186756.0], ['2015/2', 108485.0, 141719.0, 108485.0, 167974.0], ['2015/3', 141719.0, 142701.0, 141719.0, 204474.0], ['2015/4', 142701.0, 131646.0, 142701.0, 195797.0], ['2015/5', 131646.0, 144347.0, 131646.0, 192106.0], ['2015/6', 144347.0, 151292.0, 144347.0, 202967.0], ['2015/7', 151292.0, 136473.0, 151292.0, 199379.0], ['2015/8', 136473.0, 145317.0, 136473.0, 195591.0], ['2015/9', 145317.0, 130903.0, 145317.0, 197212.0], ['2015/10', 130903.0, 142616.0, 130903.0, 200667.0], ['2015/11', 142616.0, 163506.0, 142616.0, 187329.0], ['2015/12', 163506.0, 112547.0, 163506.0, 185049.0], ['2016/1', 112547.0, 93558.0, 112547.0, 171007.0], ['2016/2', 93558.0, 130188.0, 93558.0, 173210.0], ['2016/3', 130188.0, 126829.0, 130188.0, 183545.0], ['2016/4', 126829.0, 130867.0, 126829.0, 179136.0], ['2016/5', 130867.0, 131262.0, 130867.0, 188698.0], ['2016/6', 131262.0, 132312.0, 131262.0, 193890.0], ['2016/7', 132312.0, 138734.0, 132312.0, 187009.0], ['2016/8', 138734.0, 142951.0, 138734.0, 199512.0], ['2016/9', 142951.0, 128671.0, 142951.0, 191137.0], ['2016/10', 128671.0, 150477.0, 128671.0, 197383.0], ['2016/11', 150477.0, 169470.0, 150477.0, 196577.0], ['2016/12', 169470.0, 131596.0, 169470.0, 189048.0], ['2017/1', 131596.0, 129787.0, 131596.0, 191252.0], ['2017/2', 129787.0, 156541.0, 129787.0, 174335.0], ['2017/3', 156541.0, 141251.0, 156541.0, 199743.0], ['2017/4', 141251.0, 149166.0, 141251.0, 191453.0], ['2017/5', 149166.0, 153537.0, 149166.0, 206350.0], ['2017/6', 153537.0, 147269.0, 153537.0, 204033.0], ['2017/7', 147269.0, 157997.0, 147269.0, 197679.0], ['2017/8', 157997.0, 170567.0, 157997.0, 207541.0], ['2017/9', 170567.0, 151004.0, 170567.0, 200364.0], ['2017/10', 151004.0, 177405.0, 151004.0, 216612.0], ['2017/11', 177405.0, 177672.0, 177405.0, 213413.0], ['2017/12', 177672.0, 181151.0, 177672.0, 205700.0], ['2018/1', 181151.0, 138345.0, 181151.0, 209366.0], ['2018/2', 138345.0, 179694.0, 138345.0, 192768.0], ['2018/3', 179694.0, 172719.0, 179694.0, 213836.0], ['2018/4', 172719.0, 188177.0, 172719.0, 211011.0], ['2018/5', 188177.0, 174691.0, 188177.0, 222739.0], ['2018/6', 174691.0, 186914.0, 174691.0, 218583.0], ['2018/7', 186914.0, 190657.0, 186914.0, 222989.0], ['2018/8', 190657.0, 195143.0, 190657.0, 228575.0], ['2018/9', 195143.0, 181792.0, 195143.0, 217993.0], ['2018/10', 181792.0, 182443.0, 181792.0, 242981.0], ['2018/11', 182443.0, 164055.0, 182443.0, 220170.0], ['2018/12', 164055.0, 179670.0, 164055.0, 213212.0], ['2019/1', 179670.0, 132371.0, 179670.0, 210819.0], ['2019/2', 132371.0, 166867.0, 132371.0, 191041.0], ['2019/3', 166867.0, 180532.0, 166867.0, 213664.0], ['2019/4', 180532.0, 172773.0, 180532.0, 214987.0], ['2019/5', 172773.0, 162817.0, 172773.0, 226663.0], ['2019/6', 162817.0, 177758.0, 162817.0, 212832.0], ['2019/7', 177758.0, 180157.0, 177758.0, 224953.0], ['2019/8', 180157.0, 179137.0, 180157.0, 221702.0], ['2019/9', 179137.0, 170671.0, 179137.0, 212439.0], ['2019/10', 170671.0, 184266.0, 170671.0, 225377.0], ['2019/11', 184266.0, 191390.0, 184266.0, 205005.0], ['2019/12', 191390.0, 156921.0, 191390.0, 207963.0], ['2020/1', 156921.0, 142372.0, 156921.0, 201862.0], ['2020/2', 142372.0, 164603.0, 142372.0, 183512.0], ['2020/3', 164603.0, 154547.0, 164603.0, 199853.0], ['2020/4', 154547.0, 144811.0, 154547.0, 170940.0], ['2020/5', 144811.0, 168167.0, 144811.0, 169026.0], ['2020/6', 168167.0, 176530.0, 168167.0, 184823.0], ['2020/7', 176530.0, 177272.0, 176530.0, 206368.0], ['2020/8', 177272.0, 203269.0, 177272.0, 209542.0], ['2020/9', 203269.0, 178908.0, 203269.0, 212799.0], ['2020/10', 178908.0, 192663.0, 178908.0, 226403.0], ['2020/11', 192663.0, 205898.0, 192663.0, 219509.0], ['2020/12', 205898.0, 201803.0, 205898.0, 222297.0], ['2021/1', 201803.0, 169304.0, 201803.0, 211630.0], ['2021/2', 169304.0, 228794.0, 169304.0, 199954.0], ['2021/3', 228794.0, 222392.0, 228794.0, 244840.0], ['2021/4', 222392.0, 219948.0, 222392.0, 234594.0], ['2021/5', 219948.0, 229994.0, 219948.0, 238523.0], ['2021/6', 229994.0, 225122.0, 229994.0, 250893.0], ['2021/7', 225122.0, 234057.0, 225122.0, 246139.0], ['2021/8', 234057.0, 236651.0, 234057.0, 254805.0], ['2021/9', 236651.0, 214245.0, 236651.0, 254268.0], ['2021/10', 214245.0, 251927.0, 214245.0, 261473.0], ['2021/11', 251927.0, 245175.0, 251927.0, 269783.0], ['2021/12', 245175.0, 243972.0, 245175.0, 268413.0], ['2022/1', 243972.0, 188620.0, 243972.0, 257588.0], ['2022/2', 188620.0, 230017.0, 188620.0, 244062.0], ['2022/3', 230017.0, 222674.0, 230017.0, 307501.0], ['2022/4', 222674.0, 227787.0, 222674.0, 284479.0], ['2022/5', 227787.0, 230100.0, 227787.0, 297226.0], ['2022/6', 230100.0, 229223.0, 230100.0, 298064.0], ['2022/7', 229223.0, 233392.0, 229223.0, 282359.0], ['2022/8', 233392.0, 236092.0, 233392.0, 295505.0], ['2022/9', 236092.0, 211906.0, 236092.0, 286297.0], ['2022/10', 211906.0, 224831.0, 211906.0, 292254.0], ['2022/11', 224831.0, 227893.0, 224831.0, 265099.0], ['2022/12', 227893.0, 192597.0, 227893.0, 261319.0], ['2023/1', 192597.0, 196778.0, 192597.0, 262949.0], ['2023/2', 196778.0, 225419.0, 196778.0, 237999.0], ['2023/3', 225419.0, 203177.0, 225419.0, 270480.0], ['2023/4', 203177.0, 216003.0, 203177.0, 258231.0], ['2023/5', 216003.0, 214275.0, 216003.0, 271922.0], ['2023/6', 214275.0, 201391.0, 214275.0, 265141.0], ['2023/7', 201391.0, 216626.0, 201391.0, 262864.0], ['2023/8', 216626.0, 221237.0, 216626.0, 273267.0], ['2023/9', 221237.0, 218213.0, 221237.0, 268427.0], ['2023/10', 218213.0, 223539.0, 218213.0, 284258.0], ['2023/11', 223539.0, 231853.0, 223539.0, 291664.0]
]);

//切割数组，把数组中的日期和数据分离，返回数组中的日期和数据
function splitData(rawData) {
    var categoryData = [];
    var values = [];

    for (var i = 0; i < rawData.length; i++) {
        categoryData.push(rawData[i].splice(0, 1)[0]);
        values.push(rawData[i])
    }
    return {
        categoryData: categoryData, //数组中的日期 x轴对应的日期
        values: values              //数组中的数据 y轴对应的数据
    };
}

function calculateMA(dayCount) {
    var result = [];
    for (var i = 0, len = data0.values.length; i < len; i++) {
        if (i < dayCount) {
            result.push('-');
            continue;   //结束单次循环，即不输出本次结果
        }
        var sum = 0;
        for (var j = 0; j < dayCount; j++) {
            sum += data0.values[i - j][1];
        }
        result.push(sum / dayCount);
    }
    return result;
}

option = {
    tooltip: {  //提示框
        trigger: 'axis',    //触发类型：坐标轴触发
        axisPointer: {  //坐标轴指示器配置项
            type: 'cross'   //指示器类型，十字准星
        }
    },
    legend: {   //图例控件，点击图例控制哪些系列不现实
        data: ['单月进口交易额（单位：百万美元）', '3月平均', '6月平均', '12月平均', '24月平均']
    },
    grid: {     //直角坐标系
        show: true,
        left: '10%',    //grid组件离容器左侧的距离
        right: '10%',
        bottom: '15%',
        //backgroundColor:'#ccc'
    },
    xAxis: {
        type: 'category',   //坐标轴类型，类目轴
        data: data0.categoryData,
        //scale: true,  //只在数字轴中有效
        boundaryGap: false,    //刻度作为分割线，标签和数据点会在两个刻度上
        axisLine: { onZero: false },
        splitLine: { show: false },   //是否显示坐标轴轴线
        //splitNumber: 20,    //坐标轴的分割段数，预估值，在类目轴中无效
        min: 'dataMin', //特殊值，数轴上的最小值作为最小刻度
        max: 'dataMax'  //特殊值，数轴上的最大值作为最大刻度
    },
    yAxis: {
        scale: true,    //坐标刻度不强制包含零刻度
        splitArea: {
            show: true  //显示分割区域
        }
    },
    dataZoom: [     //用于区域缩放
        {
            filterMode: 'filter',    //当前数据窗口外的数据被过滤掉来达到数据窗口缩放的效果  默认值filter
            type: 'inside', //内置型数据区域缩放组件
            start: 50,      //数据窗口范围的起始百分比
            end: 100        //数据窗口范围的结束百分比
        },
        {
            show: true,
            type: 'slider', //滑动条型数据区域缩放组件
            y: '90%',
            start: 50,
            end: 100
        }
    ],
    series: [   //图表类型
        {
            name: '单月进口交易额（单位：百万美元）',
            type: 'candlestick',    //K线图
            data: data0.values,     //y轴对应的数据
            markPoint: {    //图表标注
                label: {    //标注的文本
                    normal: {   //默认不显示标注
                        show: true,
                        //position:['20%','30%'],
                        formatter: function (param) {   //标签内容控制器
                            return param != null ? Math.round(param.value) : '';
                        }
                    }
                },
                tooltip: {      //提示框
                    formatter: function (param) {
                        return param.name + '<br>' + (param.data.coord || '');
                    }
                }
            },
        },

        {
            name: '3月平均',
            type: 'line',
            data: calculateMA(3),
            smooth: true,
            lineStyle: {
                normal: { opacity: 0.5 }
            }
        },
        {
            name: '6月平均',
            type: 'line',
            data: calculateMA(6),
            smooth: true,
            lineStyle: {
                normal: { opacity: 0.5 }
            }
        },
        {
            name: '12月平均',
            type: 'line',
            data: calculateMA(12),
            smooth: true,
            lineStyle: {
                normal: { opacity: 0.5 }
            }
        },
        {
            name: '24月平均',
            type: 'line',
            data: calculateMA(24),
            smooth: true,
            lineStyle: {
                normal: { opacity: 0.5 }
            }
        },
    ]
};

myChart.setOption(option);
